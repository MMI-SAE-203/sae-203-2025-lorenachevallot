---
import Logo from "../assets/svg/logo.svg";
import Rechercher from "../assets/svg/element_loupe.svg";
---

<header
    class="relative w-full p-0 bg-cover bg-center text-white bg-black z-10 flex flex-col justify-center items-center lg:flex-row lg:gap-4 lg:justify-between lg:items-center lg:px-8 lg:py-4"
>
    <div
        class="header top-0 left-0 w-full flex items-center justify-between px-6 py-4 z-20 lg:flex-row lg:w-auto"
    >
        <a href="/"><img src={Logo.src} alt="logo Cinemagny" class="w-12" /></a>
        <div class="flex gap-4 items-center lg:hidden">
            <button class="p-2 block lg:hidden">
                <img src={Rechercher.src} alt="search" class="w-8 h-8 invert" />
            </button>
            <button
                class="relative z-20 flex h-6 w-8 flex-col justify-between *:h-[2px] *:w-full *:bg-white lg:hidden lg:*:hidden"
                id="menu-btn"
                aria-label="Menu"
                aria-controls="menu"
                aria-expanded="false"
            >
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>

    <nav
        class="visible fixed z-10 inset-0 bg-white text-2xl text-black opacity-100 transition-all duration-300 ease-in-out max-lg:aria-hidden:invisible max-lg:aria-hidden:opacity-0 lg:relative lg:items-center lg:bg-transparent lg:text-sm lg:font-bold lg:uppercase lg:tracking-wide lg:opacity-100 lg:text-white lg:flex-row py-8"
        id="menu"
        aria-hidden="true"
    >
        <ul class="mt-[25vh] h-auto px-8 lg:m-0 lg:flex lg:gap-4">
            <li class="dropdown-menu group relative overflow-visible">
                <a
                    href="/programmation"
                    class="hover:text-primary dropdown-toggle block pb-6 pt-2 relative"
                >
                    Programmation
                    <span
                        class="underline-animation absolute bottom-2 left-0 h-1 w-full transform translate-y-4 bg-white transition-all duration-300 ease-in-out group-hover:translate-y-0"
                    ></span>
                </a>
                <div
                    class="dropdown-wrapper absolute top-full left-0 pt-2 overflow-hidden max-h-0 group-hover:max-h-40 transition-all duration-300 ease-in-out"
                >
                    <ul
                        class="dropdown-content bg-black py-2 px-4 min-w-max z-30 origin-top transform scale-y-0 group-hover:scale-y-100 transition-transform duration-300 ease-in-out"
                    >
                        <li class="py-1">
                            <a
                                href="/activites"
                                class="hover:text-primary whitespace-nowrap"
                                >Activités</a
                            >
                        </li>
                    </ul>
                </div>
            </li>
            <li class="relative overflow-visible">
                <a
                    href="/billetterie"
                    class="hover:text-primary block pb-6 pt-2 relative"
                >
                    Billetterie
                    <span
                        class="underline-animation absolute bottom-2 left-0 h-1 w-full transform translate-y-4 bg-white transition-all duration-300 ease-in-out hover:translate-y-0"
                    ></span>
                </a>
            </li>
            <li class="dropdown-menu group relative overflow-visible">
                <a
                    href="/"
                    class="hover:text-primary dropdown-toggle block pb-6 pt-2 relative"
                >
                    Infos pratiques
                    <span
                        class="underline-animation absolute bottom-2 left-0 h-1 w-full transform translate-y-4 bg-white transition-all duration-300 ease-in-out group-hover:translate-y-0"
                    ></span>
                </a>
                <div
                    class="dropdown-wrapper absolute top-full left-0 pt-2 overflow-hidden max-h-0 group-hover:max-h-40 transition-all duration-300 ease-in-out"
                >
                    <ul
                        class="dropdown-content bg-black py-2 px-4 min-w-max z-30 origin-top transform scale-y-0 group-hover:scale-y-100 transition-transform duration-300 ease-in-out"
                    >
                        <li class="py-1">
                            <a
                                href="/ecologie"
                                class="hover:text-primary whitespace-nowrap"
                                >Écoresponsabilité</a
                            >
                        </li>
                    </ul>
                </div>
            </li>
            <li class="relative overflow-visible">
                <a
                    href="/invite"
                    class="hover:text-primary block pb-6 pt-2 relative"
                >
                    Invités
                    <span
                        class="underline-animation absolute bottom-2 left-0 h-1 w-full transform translate-y-4 bg-white transition-all duration-300 ease-in-out hover:translate-y-0"
                    ></span>
                </a>
            </li>
            <li class="dropdown-menu group relative overflow-visible">
                <a
                    href="/a-propos"
                    class="hover:text-primary dropdown-toggle block pb-6 pt-2 relative"
                >
                    À Propos
                    <span
                        class="underline-animation absolute bottom-2 left-0 h-1 w-full transform translate-y-4 bg-white transition-all duration-300 ease-in-out group-hover:translate-y-0"
                    ></span>
                </a>
                <div
                    class="dropdown-wrapper absolute top-full left-0 pt-2 overflow-hidden max-h-0 group-hover:max-h-40 transition-all duration-300 ease-in-out"
                >
                    <ul
                        class="dropdown-content bg-black py-2 px-4 min-w-max z-30 origin-top transform scale-y-0 group-hover:scale-y-100 transition-transform duration-300 ease-in-out"
                    >
                        <li class="py-1">
                            <a
                                href="/contact"
                                class="hover:text-primary whitespace-nowrap"
                                >Contact</a
                            >
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </nav>
</header>

<script>
    const toggle = document.querySelector("#menu-btn");
    const nav = document.querySelector("#menu");
    const page = document.body;
    const header = document.querySelector(".header");
    const dropdownToggles = document.querySelectorAll(".dropdown-toggle");

    if (toggle && nav) {
        toggle.addEventListener("click", () => {
            const isOpen = toggle.ariaExpanded === "true";
            const isClosed = !isOpen;

            toggle.ariaExpanded = String(isClosed);
            nav.ariaHidden = String(isOpen);
            page.classList.toggle("noscroll", isClosed);
            header?.classList.toggle("black", isClosed);
        });
    }

    if (window.innerWidth < 1024) {
        dropdownToggles.forEach((toggle) => {
            toggle.addEventListener("click", (e) => {
                if (window.innerWidth < 1024) {
                    e.preventDefault();
                    const wrapper = toggle.nextElementSibling;
                    const content = wrapper.querySelector(".dropdown-content");
                    const underline = toggle.querySelector(
                        ".underline-animation",
                    );

                    if (wrapper.style.maxHeight) {
                        wrapper.style.maxHeight = null;
                        content.style.transform = "scaleY(0)";
                        underline.style.transform = "translateY(4px)";
                    } else {
                        wrapper.style.maxHeight = wrapper.scrollHeight + "px";
                        content.style.transform = "scaleY(1)";
                        underline.style.transform = "translateY(0)";
                    }
                }
            });
        });
    }
</script>
